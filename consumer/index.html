<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>爱聆 AiLing | PM+ 专业心理疏导系统</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="phone">
      <div class="status-bar">
        <span id="timeDisplay">9:41</span>
        <div class="status-icons">
          <i class="fas fa-signal"></i><i class="fas fa-wifi"></i
          ><i class="fas fa-battery-full"></i>
        </div>
      </div>

      <div class="app-container">
        <!-- 首页 -->
        <div class="page active" id="homePage">
          <div class="page-scroll">
            <header class="home-header">
              <div class="greeting">
                <h1 id="greetingText">早安，探索者</h1>
                <p class="subtitle">在这片森境中，我们陪你漫游</p>
              </div>
              <div class="avatar-wrapper" onclick="switchPage('user')">
                <img
                  src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"
                  alt="avatar"
                />
                <div class="notification-dot"></div>
              </div>
            </header>

            <!-- 心情打卡 -->
            <section class="mood-section">
              <h3 class="section-title">此刻的内心天气</h3>
              <div class="mood-grid">
                <div
                  class="mood-item"
                  data-mood="happy"
                  onclick="selectMood(this)"
                >
                  <span class="mood-emoji">😊</span
                  ><span class="mood-label">喜悦</span>
                </div>
                <div
                  class="mood-item"
                  data-mood="calm"
                  onclick="selectMood(this)"
                >
                  <span class="mood-emoji">😌</span
                  ><span class="mood-label">平静</span>
                </div>
                <div
                  class="mood-item"
                  data-mood="tired"
                  onclick="selectMood(this)"
                >
                  <span class="mood-emoji">😴</span
                  ><span class="mood-label">疲惫</span>
                </div>
                <div
                  class="mood-item"
                  data-mood="anxious"
                  onclick="selectMood(this)"
                >
                  <span class="mood-emoji">😟</span
                  ><span class="mood-label">焦虑</span>
                </div>
                <div
                  class="mood-item"
                  data-mood="sad"
                  onclick="selectMood(this)"
                >
                  <span class="mood-emoji">😢</span
                  ><span class="mood-label">难过</span>
                </div>
              </div>
            </section>

            <!-- 心理图谱模块 -->
            <section class="mind-graph-card">
              <div class="card-header">
                <h3>我的心理图谱</h3>
                <div class="card-header-actions">
                  <span class="update-badge">实时更新</span>
                  <button
                    class="icon-btn-text"
                    onclick="switchPage('history')"
                    title="历史趋势"
                  >
                    <i class="fas fa-history"></i> 趋势
                  </button>
                </div>
              </div>
              <div class="radar-container">
                <!-- SVG 雷达图背景 -->
                <svg class="radar-bg" viewBox="0 0 100 100">
                  <polygon
                    points="50,10 90,30 90,70 50,90 10,70 10,30"
                    class="radar-grid"
                  />
                  <polygon
                    points="50,25 75,37.5 75,62.5 50,75 25,62.5 25,37.5"
                    class="radar-grid-inner"
                  />
                  <!-- 数据区域 -->
                  <polygon
                    id="radarData"
                    points="50,10 90,30 90,70 50,90 10,70 10,30"
                    class="radar-area"
                  />
                </svg>
                <!-- 维度标签 -->
                <span class="radar-label label-top">情绪</span>
                <span class="radar-label label-tr">压力</span>
                <span class="radar-label label-br">睡眠</span>
                <span class="radar-label label-bottom">能量</span>
                <span class="radar-label label-bl">专注</span>
                <span class="radar-label label-tl">社交</span>
              </div>
              <p class="graph-tip">基于您的对话、测评及练习数据生成</p>
            </section>

            <!-- 测评引导卡片 -->
            <section class="assessment-hero">
              <div class="assessment-content" onclick="switchPage('assess')">
                <h3>探索你的内心世界</h3>
                <p>通过专业心理测评，多维度了解真实的自己</p>
              </div>

              <!-- 快捷量表入口 -->
              <div class="assess-quick-links">
                <div
                  class="quick-link-item"
                  onclick="event.stopPropagation(); startAssessment('mbti')"
                >
                  <span class="q-emoji">🎭</span>
                  <span class="q-name">性格MBTI</span>
                </div>
                <div
                  class="quick-link-item"
                  onclick="event.stopPropagation(); startAssessment('sas')"
                >
                  <span class="q-emoji">🌡️</span>
                  <span class="q-name">焦虑自测</span>
                </div>
                <div
                  class="quick-link-item"
                  onclick="event.stopPropagation(); startAssessment('phq9')"
                >
                  <span class="q-emoji">💭</span>
                  <span class="q-name">抑郁评估</span>
                </div>
              </div>

              <div class="assessment-action" onclick="switchPage('assess')">
                <span>更多探索请前往测评中心</span>
                <i class="fas fa-chevron-right"></i>
              </div>
            </section>

            <!-- PM+ 主卡片 -->
            <section class="pm-hero-card" onclick="enterPM()">
              <div class="pm-hero-content">
                <div class="pm-badge">WHO 推荐 · PM+ 循证干预</div>
                <h2 class="pm-hero-title" id="pmHeroTitle">
                  开启你的心灵成长之旅
                </h2>
                <p class="pm-hero-desc" id="pmHeroDesc">
                  5周结构化心理疏导，已帮助全球数百万人
                </p>
                <div
                  class="pm-hero-progress"
                  id="pmHeroProgress"
                  style="display: none"
                >
                  <div class="progress-bar">
                    <div class="progress-fill" id="pmProgressFill"></div>
                  </div>
                  <span class="progress-text" id="pmProgressText">0/5 周</span>
                </div>
              </div>
              <div class="pm-hero-action">
                <span id="pmActionText">立即开始</span>
                <i class="fas fa-arrow-right"></i>
              </div>
              <div class="pm-hero-bg"><i class="fas fa-seedling"></i></div>
            </section>

            <!-- 周进度卡片 -->
            <section class="week-section" id="weekSection">
              <h3 class="section-title">PM+ 学习进度</h3>
              <div class="week-list" id="weekList"></div>
            </section>

            <!-- 今日作业 -->
            <section
              class="homework-section"
              id="homeworkSection"
              style="display: none"
            >
              <h3 class="section-title">今日练习任务</h3>
              <div class="homework-card" id="homeworkCard"></div>
            </section>

            <!-- 快捷工具 -->
            <section class="tools-section">
              <h3 class="section-title">心灵急救箱</h3>
              <div class="tools-grid">
                <div class="tool-item" onclick="openTool('breathing')">
                  <div class="tool-icon breath-icon">
                    <i class="fas fa-wind"></i>
                  </div>
                  <span>呼吸训练</span>
                </div>
                <div class="tool-item" onclick="openTool('grounding')">
                  <div class="tool-icon ground-icon">
                    <i class="fas fa-hand-holding-heart"></i>
                  </div>
                  <span>着陆技术</span>
                </div>
                <div class="tool-item" onclick="openTool('journal')">
                  <div class="tool-icon journal-icon">
                    <i class="fas fa-book-open"></i>
                  </div>
                  <span>情绪日记</span>
                </div>
                <div class="tool-item" onclick="openTool('sos')">
                  <div class="tool-icon sos-icon">
                    <i class="fas fa-phone"></i>
                  </div>
                  <span>紧急求助</span>
                </div>
              </div>
            </section>
          </div>
        </div>

        <!-- PM+ 会话页 -->
        <div class="page" id="pmPage">
          <div class="chat-container">
            <div class="chat-header">
              <button class="back-btn" onclick="exitPM()">
                <i class="fas fa-chevron-left"></i>
              </button>
              <div class="counselor-info">
                <div class="counselor-avatar">
                  <i class="fas fa-user-md"></i>
                </div>
                <div class="counselor-meta">
                  <h4>AI 心理咨询师</h4>
                  <div class="online-status">
                    <span class="status-dot"></span>在线中
                  </div>
                </div>
              </div>
              <div class="session-info" id="sessionInfo">预评估</div>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="chat-input-area" id="chatInputArea"></div>
          </div>
        </div>

        <!-- 测评中心页 -->
        <div class="page" id="assessPage">
          <div class="page-scroll">
            <header class="page-header">
              <h1>心理测评中心</h1>
              <p class="subtitle">科学认知，探索自我</p>
            </header>
            <div class="assess-list" id="assessList"></div>
          </div>
        </div>

        <!-- AiLing 聊天页 -->
        <div class="page" id="aiPage">
          <div class="chat-container">
            <div class="chat-header">
              <button class="back-btn" onclick="switchPage('home')">
                <i class="fas fa-chevron-left"></i>
              </button>
              <div class="counselor-info">
                <div class="counselor-avatar ai-avatar">
                  <i class="fas fa-ghost"></i>
                </div>
                <div class="counselor-meta">
                  <h4>AiLing 心灵伙伴</h4>
                  <p class="ai-desc">循证心理陪伴 · 随时倾听</p>
                </div>
              </div>
              <button class="chat-menu-btn" onclick="showAiChatMenu()">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>
            <!-- 快捷话题 -->
            <div class="quick-topics" id="quickTopics">
              <div
                class="topic-chip"
                onclick="sendQuickTopic('我今天心情不太好')"
              >
                😔 心情不好
              </div>
              <div
                class="topic-chip"
                onclick="sendQuickTopic('我最近压力很大')"
              >
                😰 压力很大
              </div>
              <div
                class="topic-chip"
                onclick="sendQuickTopic('我想学习放松技巧')"
              >
                🧘 学放松
              </div>
              <div
                class="topic-chip"
                onclick="sendQuickTopic('我睡眠不好怎么办')"
              >
                😴 睡眠问题
              </div>
            </div>
            <div class="chat-messages" id="aiChatMessages">
              <div class="bubble ai">嗨，我是 AiLing！今天想聊些什么呢？😊</div>
              <div class="bubble ai">
                你可以点击上方的快捷话题，或者直接输入文字/语音和我交流～
              </div>
            </div>
            <!-- 输入区域：支持文本和语音双模式 -->
            <div class="ai-chat-input-area" id="aiInputArea">
              <!-- 文本输入模式 -->
              <div class="input-mode text-mode" id="textInputMode">
                <div class="input-row">
                  <button
                    class="mode-switch-btn"
                    onclick="switchToVoiceMode()"
                    title="切换语音"
                  >
                    <i class="fas fa-microphone"></i>
                  </button>
                  <input
                    type="text"
                    id="aiChatInput"
                    placeholder="输入你想说的话..."
                    onkeypress="if(event.key==='Enter')sendAiChat()"
                  />
                  <button class="send-btn" onclick="sendAiChat()">
                    <i class="fas fa-paper-plane"></i>
                  </button>
                </div>
              </div>
              <!-- 语音输入模式 -->
              <div
                class="input-mode voice-mode"
                id="voiceInputMode"
                style="display: none"
              >
                <div class="voice-input-container">
                  <button
                    class="mode-switch-btn"
                    onclick="switchToTextMode()"
                    title="切换文字"
                  >
                    <i class="fas fa-keyboard"></i>
                  </button>
                  <button
                    class="voice-record-btn"
                    id="voiceRecordBtn"
                    onmousedown="startVoiceRecord(event)"
                    onmouseup="stopVoiceRecord(event)"
                    ontouchstart="startVoiceRecord(event)"
                    ontouchend="stopVoiceRecord(event)"
                  >
                    <span class="voice-record-text" id="voiceRecordText"
                      >按住 说话</span
                    >
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 语音录制全屏模态 -->
        <div class="voice-recording-modal" id="voiceRecordingModal">
          <div class="voice-modal-content">
            <div class="voice-cancel-zone" id="voiceCancelZone">
              <i class="fas fa-times"></i>
              <span>松开取消</span>
            </div>
            <div class="voice-visual">
              <div class="voice-ripple"></div>
              <div class="voice-ripple delay-1"></div>
              <div class="voice-ripple delay-2"></div>
              <div class="voice-mic-circle">
                <i class="fas fa-microphone"></i>
              </div>
            </div>
            <p class="voice-status" id="voiceStatus">正在聆听...</p>
            <p class="voice-timer" id="voiceTimer">0:00</p>
            <p class="voice-hint">松开发送，上滑取消</p>
          </div>
        </div>

        <!-- 能量坊 -->
        <div class="page" id="toolsPage">
          <div class="page-scroll">
            <header class="page-header">
              <h1>心灵能量坊</h1>
              <p class="subtitle">小工具帮你快速调节情绪</p>
            </header>
            <div class="energy-tools" id="energyTools"></div>
          </div>
        </div>

        <!-- 个人中心 -->
        <div class="page" id="userPage">
          <div class="page-scroll">
            <div class="user-profile" id="userProfile"></div>
          </div>
        </div>

        <!-- 历史趋势页 -->
        <div class="page" id="historyPage">
          <div class="page-scroll">
            <header class="page-header sticky-header">
              <div class="header-left">
                <button class="back-btn-simple" onclick="switchPage('home')">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <h1>历史趋势</h1>
              </div>
            </header>

            <div class="history-content">
              <div class="history-summary-card">
                <div class="summary-item">
                  <span class="label">记录次数</span>
                  <span class="value" id="historyCount">0</span>
                </div>
                <div class="summary-item">
                  <span class="label">最高能量</span>
                  <span class="value" id="maxEnergy">0</span>
                </div>
                <div class="summary-item">
                  <span class="label">进步指数</span>
                  <span class="value text-success">+15%</span>
                </div>
              </div>

              <div class="timeline-container" id="historyTimeline">
                <!-- 动态渲染时间轴 -->
              </div>
            </div>
          </div>
        </div>

        <!-- 量表答题页 -->
        <div class="page" id="quizPage">
          <div class="quiz-container">
            <header class="quiz-header">
              <button class="back-btn-simple" onclick="confirmExitQuiz()">
                <i class="fas fa-times"></i>
              </button>
              <div class="quiz-progress-wrapper">
                <div class="quiz-progress-bar">
                  <div class="quiz-progress-fill" id="quizProgressFill"></div>
                </div>
                <span id="quizProgressText">0/0</span>
              </div>
            </header>
            <div class="quiz-content">
              <h2 class="quiz-question" id="quizQuestion">加载中...</h2>
              <div class="quiz-options" id="quizOptions"></div>
            </div>
          </div>
        </div>

        <!-- 测评报告页 -->
        <div class="page" id="quizResultPage">
          <div class="page-scroll">
            <header class="page-header result-header">
              <button class="back-btn-simple" onclick="switchPage('assess')">
                <i class="fas fa-arrow-left"></i>
              </button>
              <h1>测评报告</h1>
            </header>
            <div class="result-container" id="quizResultDetail">
              <!-- 动态渲染报告内容 -->
            </div>
          </div>
        </div>

        <!-- PM+ 系统介绍页 (Landing Page) -->
        <div class="page" id="pmIntroPage">
          <div class="page-scroll">
            <header class="pm-intro-header">
              <button class="back-btn-simple" onclick="switchPage('home')">
                <i class="fas fa-chevron-left"></i>
              </button>
              <div class="header-content">
                <div class="pm-badge-pill">WHO 推荐 · 循证心理干预</div>
                <h1>PM+ 问题管理系统</h1>
                <p>跨越心理困境的 5 周结构化旅程</p>
              </div>
            </header>

            <div class="pm-intro-content">
              <!-- 核心价值 -->
              <section class="pm-intro-section">
                <h3 class="intro-title">为什么选择 PM+？</h3>
                <div class="value-grid">
                  <div class="value-item">
                    <i class="fas fa-microscope"></i>
                    <h4>科学严谨</h4>
                    <p>基于世界卫生组织(WHO)开发的成熟心理干预协议</p>
                  </div>
                  <div class="value-item">
                    <i class="fas fa-chess-knight"></i>
                    <h4>技能导向</h4>
                    <p>不只是倾听，更教你如何解决现实生活中的心理挑战</p>
                  </div>
                  <div class="value-item">
                    <i class="fas fa-mobile-alt"></i>
                    <h4>随时随地</h4>
                    <p>AI 咨询师 24/7 陪伴，按你的节奏进行 5 周练习</p>
                  </div>
                </div>
              </section>

              <!-- 课程大纲 -->
              <section class="pm-intro-section">
                <h3 class="intro-title">5 周成长蓝图</h3>
                <div class="roadmap">
                  <div class="road-item">
                    <div class="road-num">1</div>
                    <div class="road-text">
                      <h4>应对压力</h4>
                      <p>学习腹式呼吸，掌握即时放松技巧</p>
                    </div>
                  </div>
                  <div class="road-item">
                    <div class="road-num">2</div>
                    <div class="road-text">
                      <h4>解决问题</h4>
                      <p>结构化拆解难题，找回掌控感</p>
                    </div>
                  </div>
                  <div class="road-item">
                    <div class="road-num">3</div>
                    <div class="road-text">
                      <h4>行为激活</h4>
                      <p>打破抑郁循环，重新投入生活</p>
                    </div>
                  </div>
                  <div class="road-item">
                    <div class="road-num">4</div>
                    <div class="road-text">
                      <h4>社交支持</h4>
                      <p>强化人际连接，建立情感缓冲带</p>
                    </div>
                  </div>
                  <div class="road-item">
                    <div class="road-num">5</div>
                    <div class="road-text">
                      <h4>防止复发</h4>
                      <p>巩固技能，从容面对未来挑战</p>
                    </div>
                  </div>
                </div>
              </section>

              <!-- 信任背书 -->
              <section class="pm-intro-section quote-section">
                <div class="testimonial">
                  <p>
                    “这是我参与过最科学的心理训练，它给我的不仅仅是安慰，更是实实在在应对困难的‘武器’。”
                  </p>
                  <span class="author">—— 某匿名用户</span>
                </div>
              </section>
            </div>

            <!-- 悬浮底部支付 -->
            <div class="pm-fixed-footer">
              <div class="price-info">
                <span class="old-price">原价 ¥199</span>
                <div class="now-price">限时优惠 <span>¥99</span></div>
              </div>
              <button class="pm-buy-btn" onclick="confirmPurchasePM()">
                立即购买 PM+ 课程
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 底部导航 -->
      <nav class="nav-bar" id="navBar">
        <div
          class="nav-item active"
          data-page="home"
          onclick="switchPage('home')"
        >
          <i class="fas fa-house"></i><span>首页</span>
        </div>
        <div class="nav-item" data-page="assess" onclick="switchPage('assess')">
          <i class="fas fa-compass"></i><span>测评</span>
        </div>
        <div class="nav-item ai-nav" data-page="ai" onclick="switchPage('ai')">
          <div class="ai-btn"><i class="fas fa-ghost"></i></div>
          <span>AiLing</span>
        </div>
        <div class="nav-item" data-page="tools" onclick="switchPage('tools')">
          <i class="fas fa-leaf"></i><span>能量坊</span>
        </div>
        <div class="nav-item" data-page="user" onclick="switchPage('user')">
          <i class="fas fa-user"></i><span>我的</span>
        </div>
      </nav>

      <!-- 弹层容器 -->
      <div class="overlay" id="overlay"></div>
      <div class="sheet" id="sheet"></div>
      <div class="modal" id="modal"></div>
    </div>

    <script src="data.js"></script>
    <script src="pm-flow.js"></script>
    <script src="app.js"></script>
  </body>
</html>
